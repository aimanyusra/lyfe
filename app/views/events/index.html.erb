<p id="notice"><%= notice %></p>


<div class="container">
        <div class="row">
          <% @events.each_with_index do |event, i| %>
            <div class="col-sm-6 col-md-4 col-lg-3 mt-4">
                <div class="card">
                    <img class="card-img-top" src="http://success-at-work.com/wp-content/uploads/2015/04/free-stock-photos.gif">
                    <div class="card-block">
                        <figure class="profile">
                            <img src="http://success-at-work.com/wp-content/uploads/2015/04/free-stock-photos.gif" class="profile-avatar" alt="">
                        </figure>
                        <h4 class="card-title mt-3"><%= event.title %></h4>
                        <div class="meta">
                            <a>STATE : <%= event.state %></a><br>
                            <a>DATE : <%= event.start_time.strftime("%d-%m-%Y") %></a><br>
                        </div>
                        <div class="card-text">
                        <%= event.description %>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-secondary float-right btn-sm"><%= link_to event do %>SHOW<% end %></button>
                        <button class="btn btn-secondary float-right btn-sm"><%= link_to event_user_path(event), data: { confirm: 'You sure going?' } do %>JOIN<% end %></button>
                    </div>
                </div>
                <br>
            </div>
          <% end %>
        </div>
</div>








<h1>Un-Joined Events</h1>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <!-- <th>Status</th> -->
      <th>Description</th>
      <th>Start date</th>
      <th>End date</th>
      <th>Location</th>
      <th>Start Time</th>
      <th>End Time</th>
      <th>Age limit</th>
      <th>Price</th>
      <th>Tags</th>
      <th>State</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
   <% if @events %>
    <% @events.each do |event| %>
      <tr>
        <td><%= event.title %></td>
        <!-- <td><%= event.status %></td> -->
        <td><%= event.description %></td>
        <td><%= event.location %></td>
        <td><%= event.start_time %></td>
        <td><%= event.end_time %></td>
        <td><%= event.age_limit %></td>
        <td><%= event.price %></td>
        <td><% event.tags.each do |x| %>
            <%= x.desc %>
            <% end %></td>
        <td><%= event.state %></td>
        <td><%= link_to 'Show', event %></td>

        <% if current_user %>
          <%if current_user.id == event.host_id %>
            <td><%= link_to 'Edit', edit_event_path(event) %></td>
            <td><%= link_to 'Destroy', event, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          <%end%>
        
          <td><%= link_to 'Join', event_user_path(event), data: { confirm: 'You sure going?' } %></td>

          <% @favorites = Favorite.where(object: 'event')%>
          <% @favorites = @favorites.where(objectid: event.id)%>
          <% if !@favorites.where(user_id: current_user.id).any? %>
          
            <td><%= link_to 'Mark as favorite', event_user_path(event), method: :patch %></td>
          <% else %>
            <td>Already favorited</td>
          <% end %>
        <% end %>
      </tr>
    <% end %>
   <% end %>
  </tbody>
</table>

<br>
<!-- just removed an end from this line -->

<h1>Joined Events</h1>

<% if @joined_event %>
<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Status</th>
      <th>Description</th>
      <th>Start date</th>
      <th>End date</th>
      <th>Location</th>
      <th>Start Time</th>
      <th>End Time</th>
      <th>Age limit</th>
      <th>Price</th>
      <th>State</th>
      <th>Tags</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @joined_event.each do |event| %>
      <tr>
        <td><%= event.title %></td>
        <td><%= event.status %></td>
        <td><%= event.description %></td>
        <td><%= event.location %></td>
        <td><%= event.start_time %></td>
        <td><%= event.end_time %></td>
        <td><%= event.age_limit %></td>
        <td><%= event.price %></td>
        <td><%= event.state %></td>
        <td><% event.tags.each do |x| %>
            <%= x.desc %>
            <% end %></td>
        <td><%= link_to 'Show', event %></td>
        <td><%= link_to 'Edit', edit_event_path(event) %></td>
        <td><%= link_to 'Destroy attendence', event_user_path(event), method: :delete, data: { confirm: 'Not going?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<% end %>

<br>

<% if current_user %>
  <%= link_to 'New Event', new_event_path %>
  <br>
  <%= link_to 'New Style', new_style_path %>
<% end %>
<br>
<br>

<%= button_to 'Google Calendar Authorization', redirect_path, method: :get %>
<%= form_tag new_gevent_url(:calendar_id) do %>
  <%= submit_tag 'Add Google event' %>
<% end %>


<div id="calendar"></div>

  <script>
  $(document).ready(function(){
    $('#calendar').fullCalendar({
      eventSources: [
        {
          googleCalendarId: "<%=current_user.email%>",
          googleCalendarApiKey: "AIzaSyDjN-X3JPQrfDbqYOx6xmxCrM6OCYWZzac"
        },
        {
          url: "/events.json",
          color: "green"
        }
      ]
    });
  });
  </script>
